- name: Create monitor key
  template: src=monitor_keyring dest=/etc/ceph/ceph.mon.{{inventory_hostname}}.keyring

- name: Ceph monitor mkfs with keyring
  command: ceph-mon --cluster ceph --setuser ceph --setgroup ceph --mkfs -i {{inventory_hostname}} --fsid {{ceph_fsid}} -f -d
  args:
    creates: /var/lib/ceph/mon/ceph-{{inventory_hostname}}/keyring

- name: Ensure the monitor is enabled and running
  service: name=ceph-mon@{{inventory_hostname}} enabled=yes state=started

# This fixes a bug for ceph-12.1.0 when the monitor service does not start automatically after a reboot.
- name: Enable the ceph-mon.target service
  systemd: name=ceph-mon.target enabled=yes masked=no
